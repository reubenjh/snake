<!DOCTYPE HTML>
<html lang="en">
<head>
    <script>
        /* NEXT STEPS:
         * - CONFIRM GENERATE_APPLE CODE CHECKS UNDER SNAKE HEAD AND BODY, IF SO, CALLS ITSELF AGAIN UNTIL A LEGAL_APPLE IS PRODUCED
         * - CHECK IF DRAWAPPLE IS ONLY DONE UPON FINDING A LEGAL_APPLE, ADD TO END OF LEGAL_APPLE CODE IF SO
         * - WRITE MOVE BODY CODE WHEN MOVING SNAKE AND BODY HAS LENGTH > 0
         * - WRITE DRAW BODY CODE
         * - TITLE SCREEN
         */

        var canvas;
        var canvasContext;

        /* snakeX and snakeY are just center starting positions.
         * Have to hardcode canvas.width/2 as 300 as canvas.width isn't 
         * set until window.onload
         */
        const SNAKE_THICKNESS = 10;
        var snakeX = 300 - (SNAKE_THICKNESS/2);
        var snakeY = 300 - (SNAKE_THICKNESS/2);
        var snakeHeadCenterPoint = {
            x: snakeX+(SNAKE_THICKNESS/2),
            y: snakeY+(SNAKE_THICKNESS/2)
            }
        var snakeBody = [];
        var snakeSpeed = 3;
        var snakeDirection = '';
        
        var apple = {};
        const APPLE_THICKNESS = 8;
  
        


        window.onload = function() {
            /* Access canvas to draw on
             */
            canvas = document.getElementById('myCanvas');
            canvasContext = canvas.getContext('2d');

            clearCanvas();
            drawSnakeHead();
            generateApple();
            drawApple();
            /* Add directional arrow controls
             */
            document.addEventListener('keydown', function(event) {
                // Prevent default page scrolling
                event.preventDefault();
                // Right key
                if (event.which == 39) {
                    // Snake can't reverse
                    if (snakeDirection == 'left') {
                        return;
                    } else
                    snakeDirection = 'right';
                }
                // Left key
                if (event.which == 37) {
                    // Snake can't reverse
                    if (snakeDirection == 'right') {
                        return;
                    } else
                    snakeDirection = 'left';
                }
                // Down key
                if (event.which == 40) {
                    // Snake can't reverse
                    if (snakeDirection == 'up') {
                        return;
                    } else
                    snakeDirection = 'down';
                }
                // Up key
                if (event.which == 38) {
                    // Snake can't reverse
                    if (snakeDirection == 'down') {
                        return;
                    } else
                    snakeDirection = 'up';
                }
            });


            /* Setting initial speed
             */
            var framesPerSecond = 30
            setInterval(function() {
                moveSnake();
                drawEverything();
            }, 1000/framesPerSecond);   
        }


        function drawSnakeHead() {
            canvasContext.fillStyle = 'white';
            canvasContext.fillRect(snakeX,snakeY,SNAKE_THICKNESS,SNAKE_THICKNESS);
        }
        

        function clearCanvas() {
            canvasContext.fillStyle = 'black';
            canvasContext.fillRect(0,0,canvas.width, canvas.height);
        }


        function generateApple() {
            apple.x = Math.floor(Math.random()*(canvas.width+1));
            apple.y = Math.floor(Math.random()*(canvas.height+1));
            checkLegalApple(apple.x, apple.y)

        }

        // this might be able to go in generateapple? Is that the only place its called?
        function drawApple() {
            canvasContext.fillStyle = 'green';
            canvasContext.beginPath();
            canvasContext.arc(apple.x, apple.y, APPLE_THICKNESS/2, 0, Math.PI*2, true);
            canvasContext.fill();
        }


        function checkLegalApple (appleX, appleY) {
            /* Checking its not squished up against the side
             */
            if (appleX - (APPLE_THICKNESS*2) < 0) {
                return generateApple()
            }
            if (appleX + (APPLE_THICKNESS*2) > canvas.width) {
                return generateApple();
            }
            if (appleY - (APPLE_THICKNESS*2) < 0) {
                return generateApple();
            }
            if (appleY + (APPLE_THICKNESS*2) > canvas.height) {
                return generateApple();
            }

            // Write code to check its' not under a snake part

        }






        function checkCollision() {
            // Checking colission with snake head
            if (snakeHeadCenterPoint.x+(SNAKE_THICKNESS/2) > apple.x-(APPLE_THICKNESS/2) && snakeHeadCenterPoint.x-(SNAKE_THICKNESS/2) < apple.x+(APPLE_THICKNESS/2)) {
                if (snakeHeadCenterPoint.y+(SNAKE_THICKNESS/2) > apple.y-(APPLE_THICKNESS/2) && snakeHeadCenterPoint.y-(SNAKE_THICKNESS/2) < apple.y+(APPLE_THICKNESS/2)) {
                    // COLLISSION!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
                    console.log("collide");
                    // Fire grow code
                    // growSnake();
                }
            }
            // Checking colission with snake body. If so, lose
        }






        /* TO DO.
        store the current snakeX and snakeY in first object in snakeBody,
        generate a new apple (in which it checks its a legal apple), 
        draw a new apple

        function growSnake() {
            snakeBody
        }
        */






        function moveSnake() {
            if (snakeDirection != '') {
                goThisWay(snakeDirection);
            }
            checkCollision();
        }


        function goThisWay(snakeDirection) {
            if (snakeDirection == 'right') {
                snakeX += snakeSpeed;
            }
            if (snakeDirection == 'left') {
                snakeX -= snakeSpeed;
            }
            if (snakeDirection == 'down') {
                snakeY += snakeSpeed;
            }
            if (snakeDirection == 'up') {
                snakeY -= snakeSpeed;
            }

            /* Wrap through horizontal walls
             */
            if (snakeX > canvas.width) {
                snakeX -= canvas.width;
            }
            if (snakeX < 0) {
                snakeX += canvas.width;
            }
            /* Wrap through vertical walls
             */
            if (snakeY > canvas.height) {
                snakeY -= canvas.height;
            }
            if (snakeY < 0) {
                snakeY += canvas.height;
            }
            // Set new snakeHeadCenterPoint
            snakeHeadCenterPoint.x = snakeX + (SNAKE_THICKNESS/2);
            snakeHeadCenterPoint.y = snakeY + (SNAKE_THICKNESS/2);

            // Do all of the above apart from snakeheadcenterpoint on each object in
            // snakebody
        }

        function drawEverything() {
            if (snakeDirection != '') {
                clearCanvas();
                drawApple();
                drawSnakeHead();

                /* If snake has a body, draw the body
                */
                if (snakeBody.length != 0) {
                    console.log('draw the body code fires');
                    for (var i = 0; i < snakeBody.length; i++) {
                        canvasContext.fillStyle = 'white';
                        canvasContext.fillRect(snakeBody[i].x,snakeBody[i].y,SNAKE_THICKNESS,SNAKE_THICKNESS);
                    }
                }
            }
            
            /* OLD CODE
             * Snake not growing so redraw same size in new position,
             * currently blanking whole page but I don't think that will
             * work for fluid motion and directional changes, may need to
             * loop through array of snakePositions and draw a 1x1 pixel
             * everywhere the snake is not. Actually, could just redraw the
             * position balck that gets shift()'d off the snakePositions array.
             *
            canvasContext.fillStyle = 'black';
            canvasContext.fillRect(0,0,canvas.width, canvas.height);

            canvasContext.fillStyle = 'white';
            canvasContext.fillRect(snakeX,snakeY,SNAKE_THICKNESS,SNAKE_THICKNESS);
            */
        }
    
    
    </script>
</head>

<body>
    <canvas id="myCanvas" width="600" height="600"></canvas>
</body>
</html>